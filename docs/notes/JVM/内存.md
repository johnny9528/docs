# 内存



虚拟机栈 ： 栈帧 Stack Frame。 线程私有   局部变量表   

程序计数器  program counter  

本地方法栈： 主要用于执行本地（native）方法

堆（heap）: 最大的一块内存空间 所有线程共享的内存。 与之相关的重要概念是垃圾收集。堆空间划分为 新生代和老年代。 Eden空间中包含 From Survivor空间与 To Survivor空间

方法区 ： 存储元信息（静态变量， 常量， Class对象）  永久代， 从jdk1.8开始， 废弃了永久代， 使用元空间

运行时常量池： 是方法区的一部分，



直接内存： 不是Java虚拟机直接管理的内存区域， 与Java NIO密切相关





java对象创建的过程：

new 关键字创建对象的步骤：

1. 在堆内存中创建出对象的实例
2. 为对象的实例成员变量赋初值（静态变量在类加载的时候已经初始化）
3. 将对象的引用返回



指针碰撞（前提是堆中的空间通过一个指针进行分割， 一侧是已经被占用的空间， 另一侧是没有被占据的空间）：新创建对象， 指针偏移

空闲列表（前提是堆内存空间中被使用的空间与没有被使用的空间是交织在一起， 这时候， 虚拟机就需要通过一个列表来记录哪些空间是可以使用的， 哪些空间是已经被使用的， 接下来找出可以容纳下新创建对象的且没有被使用的空间， 在此空间存放该对象， 同时修改列表上的记录）

上述两种方式， 和垃圾收集器相关， 取决于垃圾收集器的垃圾收集算法。



对象在内存中的布局：

1. 对象头
2. 实例数据（一个类中声明的各项信息）
3. 对齐填充



引用指向对象的两种方式：

1. 句柄： 引用指向一个句柄，句柄在堆中，  句柄内部含有两个指针， 一个指针指向实例对象， 另一个指向方法区的类信息（元信息）
2. 直接引用： 引用直接指向实例对象， 对象内部含有一个指向方法区的类信息的指针



hotspot虚拟机采用的是第二种



